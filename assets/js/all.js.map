{"version":3,"sources":["all.js","_burger.js","_bus.js","_valid.js"],"names":["bodyElement","document","querySelector","mainElement","footerElement","burger","bgCircle","classList","add","addEventListener","toggle","getCity","endpoint","axios","get","headers","getAuthorizationHeader","then","response","cityData","data","selectCity","getElementById","str","forEach","el","City","CityName","innerHTML","console","log","err","routeData","getRoute","city","compareName","a","b","RouteName","Zh_tw","sortData","sort","showRouteResult","busSearchShow","busSearching","busSearchNone","busRouteResult","length","remove","DepartureStopNameZh","DestinationStopNameZh","Operators","OperatorName","findMatch","keyword","regExp","RegExp","filter","match","renderRoute","cacheData","AppID","AppKey","GMTString","Date","toGMTString","ShaObj","jsSHA","setHMACKey","update","HMAC","getHMAC","Authorization"],"mappings":"AAAA;;;ACAA,IAAMA,WAAW,GAAGC,QAAQ,CAACC,aAAT,CAAuB,MAAvB,CAApB;AACA,IAAMC,WAAW,GAAGF,QAAQ,CAACC,aAAT,CAAuB,MAAvB,CAApB;AACA,IAAME,aAAa,GAAGH,QAAQ,CAACC,aAAT,CAAuB,qBAAvB,CAAtB;AACA,IAAMG,MAAM,GAAGJ,QAAQ,CAACC,aAAT,CAAuB,SAAvB,CAAf;AACA,IAAMI,QAAQ,GAAGL,QAAQ,CAACC,aAAT,CAAuB,YAAvB,CAAjB;AACAG,MAAM,CAACE,SAAP,CAAiBC,GAAjB,CAAqB,WAArB;AACAH,MAAM,CAACI,gBAAP,CAAwB,OAAxB,EAAgC,YAAI;AAChCJ,EAAAA,MAAM,CAACE,SAAP,CAAiBG,MAAjB,CAAwB,SAAxB;AACAL,EAAAA,MAAM,CAACE,SAAP,CAAiBG,MAAjB,CAAwB,WAAxB;AACAJ,EAAAA,QAAQ,CAACC,SAAT,CAAmBG,MAAnB,CAA0B,QAA1B;AACAP,EAAAA,WAAW,CAACI,SAAZ,CAAsBG,MAAtB,CAA6B,QAA7B;AACAN,EAAAA,aAAa,CAACG,SAAd,CAAwBG,MAAxB,CAA+B,QAA/B;AACH,CAND;;;ACNA;AACA,SAASC,OAAT,GAAkB;AACd,MAAMC,QAAQ,GAAG,kEAAjB;AAEAC,EAAAA,KAAK,CAACC,GAAN,CAAUF,QAAV,EACI;AACIG,IAAAA,OAAO,EAAEC,sBAAsB;AADnC,GADJ,EAICC,IAJD,CAIM,UAAAC,QAAQ,EAAI;AACV,QAAMC,QAAQ,GAAGD,QAAQ,CAACE,IAA1B;AACA,QAAMC,UAAU,GAAGpB,QAAQ,CAACqB,cAAT,CAAwB,aAAxB,CAAnB;AACA,QAAIC,GAAG,GAAG,kCAAV;AACAJ,IAAAA,QAAQ,CAACK,OAAT,CAAiB,UAAAC,EAAE,EAAE;AACjBF,MAAAA,GAAG,8BAAoBE,EAAE,CAACC,IAAvB,gBAAgCD,EAAE,CAACE,QAAnC,cAAH;AACH,KAFD;AAGAN,IAAAA,UAAU,CAACO,SAAX,GAAqBL,GAArB;AACAM,IAAAA,OAAO,CAACC,GAAR,CAAYX,QAAZ;AACH,GAbL,WAcO,UAAAY,GAAG;AAAA,WAAIF,OAAO,CAACC,GAAR,CAAYC,GAAZ,CAAJ;AAAA,GAdV;AAgBH;;AAED,IAAIC,SAAS,GAAG,IAAhB,C,CACA;;AACA,SAASC,QAAT,CAAkBC,IAAlB,EAAuB;AACnB,MAAMtB,QAAQ,iEAA0DsB,IAA1D,kBAAd;AAEArB,EAAAA,KAAK,CAACC,GAAN,CAAUF,QAAV,EACI;AACIG,IAAAA,OAAO,EAAEC,sBAAsB;AADnC,GADJ,EAICC,IAJD,CAIM,UAAAC,QAAQ,EAAI;AACVc,IAAAA,SAAS,GAAGd,QAAQ,CAACE,IAArB,CADU,CAGV;;AACA,aAASe,WAAT,CAAsBC,CAAtB,EAAyBC,CAAzB,EAA6B;AACzB,UAAKD,CAAC,CAACE,SAAF,CAAYC,KAAZ,GAAoBF,CAAC,CAACC,SAAF,CAAYC,KAArC,EAA4C;AACxC,eAAO,CAAC,CAAR;AACH;;AACD,UAAKH,CAAC,CAACE,SAAF,CAAYC,KAAZ,GAAoBF,CAAC,CAACC,SAAF,CAAYC,KAArC,EAA4C;AACxC,eAAO,CAAP;AACH;;AACD,aAAO,CAAP;AACH;;AAED,QAAMC,QAAQ,GAAGR,SAAS,CAACS,IAAV,CAAeN,WAAf,CAAjB,CAdU,CAgBV;AACA;AACA;AACA;AACA;AACA;AACA;;AAEAO,IAAAA,eAAe,CAACF,QAAD,CAAf;AACH,GA7BL,WA8BO,UAAAT,GAAG;AAAA,WAAIF,OAAO,CAACC,GAAR,CAAYC,GAAZ,CAAJ;AAAA,GA9BV;AAgCH,C,CAED;;;AACA,SAASW,eAAT,CAAyBtB,IAAzB,EAA8B;AAC1B,MAAMuB,aAAa,GAAG1C,QAAQ,CAACC,aAAT,CAAuB,iBAAvB,CAAtB;AACA,MAAM0C,YAAY,GAAG3C,QAAQ,CAACC,aAAT,CAAuB,gBAAvB,CAArB;AACA,MAAM2C,aAAa,GAAG5C,QAAQ,CAACC,aAAT,CAAuB,iBAAvB,CAAtB;AACA,MAAM4C,cAAc,GAAG7C,QAAQ,CAACC,aAAT,CAAuB,kBAAvB,CAAvB;;AAEA,MAAG,CAACkB,IAAD,IAASA,IAAI,CAAC2B,MAAL,KAAgB,CAA5B,EAA+B;AAC3BH,IAAAA,YAAY,CAACrC,SAAb,CAAuBC,GAAvB,CAA2B,QAA3B;AACAqC,IAAAA,aAAa,CAACtC,SAAd,CAAwByC,MAAxB,CAA+B,QAA/B;AACH,GAHD,MAGO;AAEH,QAAIzB,GAAG,GAAG,EAAV;AAEAH,IAAAA,IAAI,CAACI,OAAL,CAAa,UAAAC,EAAE,EAAE;AACbF,MAAAA,GAAG,4LAGgCE,EAAE,CAACa,SAAH,CAAaC,KAH7C,mhBAced,EAAE,CAACwB,mBAdlB,qRAoBexB,EAAE,CAACyB,qBApBlB,+IAwBWzB,EAAE,CAAC0B,SAAH,CAAa,CAAb,EAAgBC,YAAhB,CAA6Bb,KAxBxC,2EAAH;AA4BH,KA7BD;AA+BAO,IAAAA,cAAc,CAAClB,SAAf,GAA2BL,GAA3B;AAEAqB,IAAAA,YAAY,CAACrC,SAAb,CAAuBC,GAAvB,CAA2B,QAA3B;AACAmC,IAAAA,aAAa,CAACpC,SAAd,CAAwByC,MAAxB,CAA+B,QAA/B;AACH;AAEJ,C,CAED;;;AACA,SAASK,SAAT,CAAmBC,OAAnB,EAA2B;AACvB,MAAMC,MAAM,GAAG,IAAIC,MAAJ,CAAWF,OAAX,EAAmB,IAAnB,CAAf;AACAzB,EAAAA,OAAO,CAACC,GAAR,CAAYyB,MAAZ;AACA,SAAOvB,SAAS,CAACyB,MAAV,CAAiB,UAAAhC,EAAE;AAAA,WAAEA,EAAE,CAACa,SAAH,CAAaC,KAAb,CAAmBmB,KAAnB,CAAyBH,MAAzB,KAAoC9B,EAAE,CAACwB,mBAAH,CAAuBS,KAAvB,CAA6BH,MAA7B,CAApC,IAA4E9B,EAAE,CAACyB,qBAAH,CAAyBQ,KAAzB,CAA+BH,MAA/B,CAA9E;AAAA,GAAnB,CAAP;AACH,C,CAED;;;AACA,SAASI,WAAT,CAAqBL,OAArB,EAA6B;AACzB,MAAMX,aAAa,GAAG1C,QAAQ,CAACC,aAAT,CAAuB,iBAAvB,CAAtB;AACA,MAAM0C,YAAY,GAAG3C,QAAQ,CAACC,aAAT,CAAuB,gBAAvB,CAArB;AACA,MAAM2C,aAAa,GAAG5C,QAAQ,CAACC,aAAT,CAAuB,iBAAvB,CAAtB;AACA,MAAM4C,cAAc,GAAG7C,QAAQ,CAACC,aAAT,CAAuB,kBAAvB,CAAvB;AAEA,MAAM0D,SAAS,GAAGP,SAAS,CAACC,OAAD,CAA3B;AAEA,MAAI/B,GAAG,GAAG,EAAV;;AAEA,MAAG,CAACqC,SAAD,IAAcA,SAAS,CAACb,MAAV,KAAqB,CAAtC,EAAyC;AACrClB,IAAAA,OAAO,CAACC,GAAR,CAAY,QAAZ;AACAc,IAAAA,YAAY,CAACrC,SAAb,CAAuBC,GAAvB,CAA2B,QAA3B;AACAmC,IAAAA,aAAa,CAACpC,SAAd,CAAwBC,GAAxB,CAA4B,QAA5B;AACAqC,IAAAA,aAAa,CAACtC,SAAd,CAAwByC,MAAxB,CAA+B,QAA/B;AACH,GALD,MAKO;AACHY,IAAAA,SAAS,CAACpC,OAAV,CAAkB,UAAAC,EAAE,EAAE;AAClBF,MAAAA,GAAG,4LAGgCE,EAAE,CAACa,SAAH,CAAaC,KAH7C,mhBAced,EAAE,CAACwB,mBAdlB,qRAoBexB,EAAE,CAACyB,qBApBlB,+IAwBWzB,EAAE,CAAC0B,SAAH,CAAa,CAAb,EAAgBC,YAAhB,CAA6Bb,KAxBxC,2EAAH;AA4BH,KA7BD;AA+BAO,IAAAA,cAAc,CAAClB,SAAf,GAA2BL,GAA3B;AAEAqB,IAAAA,YAAY,CAACrC,SAAb,CAAuBC,GAAvB,CAA2B,QAA3B;AACAqC,IAAAA,aAAa,CAACtC,SAAd,CAAwBC,GAAxB,CAA4B,QAA5B;AACAmC,IAAAA,aAAa,CAACpC,SAAd,CAAwByC,MAAxB,CAA+B,QAA/B;AACH;AACJ;;;AC/KD;AACA,SAAShC,sBAAT,GAAkC;AAC9B,MAAI6C,KAAK,GAAG,kCAAZ;AACA,MAAIC,MAAM,GAAG,6BAAb;AACA,MAAIC,SAAS,GAAG,IAAIC,IAAJ,GAAWC,WAAX,EAAhB;AACA,MAAIC,MAAM,GAAG,IAAIC,KAAJ,CAAU,OAAV,EAAmB,MAAnB,CAAb;AACAD,EAAAA,MAAM,CAACE,UAAP,CAAkBN,MAAlB,EAA0B,MAA1B;AACAI,EAAAA,MAAM,CAACG,MAAP,CAAc,aAAaN,SAA3B;AACA,MAAIO,IAAI,GAAGJ,MAAM,CAACK,OAAP,CAAe,KAAf,CAAX;AACA,MAAIC,aAAa,GAAG,qBAAqBX,KAArB,GAA6B,+DAA7B,GAA+FS,IAA/F,GAAsG,IAA1H;AACA,SAAO;AAAE,qBAAiBE,aAAnB;AAAkC,cAAUT;AAA5C,GAAP;AACH","file":"all.js","sourcesContent":["","const bodyElement = document.querySelector('body');\r\nconst mainElement = document.querySelector('main');\r\nconst footerElement = document.querySelector('footer.fixed-bottom');\r\nconst burger = document.querySelector('.burger');\r\nconst bgCircle = document.querySelector('.bg-circle');\r\nburger.classList.add('unToggled');\r\nburger.addEventListener('click',()=>{\r\n    burger.classList.toggle('toggled');\r\n    burger.classList.toggle('unToggled');\r\n    bgCircle.classList.toggle('d-none');\r\n    mainElement.classList.toggle('d-none');\r\n    footerElement.classList.toggle('d-none');\r\n});\r\n","// 搜尋欄取得縣市名稱\r\nfunction getCity(){\r\n    const endpoint = 'https://gist.motc.gov.tw/gist_api/V3/Map/Basic/City?$format=JSON';\r\n\r\n    axios.get(endpoint,\r\n        {\r\n            headers: getAuthorizationHeader()\r\n        })\r\n    .then(response => {\r\n            const cityData = response.data;\r\n            const selectCity = document.getElementById('select_city');\r\n            let str = \"<option selected>請先選擇縣市</option>\";\r\n            cityData.forEach(el=>{\r\n                str+=`<option value=\"${el.City}\">${el.CityName}</option>`\r\n            });\r\n            selectCity.innerHTML=str;\r\n            console.log(cityData);\r\n        })\r\n    .catch(err => console.log(err));\r\n\r\n}\r\n\r\nlet routeData = null;\r\n// 搜尋欄取得路線名稱\r\nfunction getRoute(city){\r\n    const endpoint = `https://ptx.transportdata.tw/MOTC/v2/Bus/Route/City/${city}?$format=JSON`;\r\n\r\n    axios.get(endpoint,\r\n        {\r\n            headers: getAuthorizationHeader()\r\n        })\r\n    .then(response => {\r\n            routeData = response.data;\r\n\r\n            //路線名稱首字排序\r\n            function compareName( a, b ) {\r\n                if ( a.RouteName.Zh_tw < b.RouteName.Zh_tw ){\r\n                    return -1;\r\n                }\r\n                if ( a.RouteName.Zh_tw > b.RouteName.Zh_tw ){\r\n                    return 1;\r\n                }\r\n                return 0;\r\n            }\r\n\r\n            const sortData = routeData.sort(compareName);\r\n\r\n            // const selectRoute = document.getElementById('select_route');\r\n            // let str = \"\";\r\n            // sortData.forEach(el=>{\r\n            //     str+=`<option value=\"${el.RouteUID}\">${el.RouteName.Zh_tw}</option>`\r\n            // });\r\n            // selectRoute.innerHTML=str;\r\n            // console.log(routeData);\r\n            \r\n            showRouteResult(sortData);\r\n        })\r\n    .catch(err => console.log(err));\r\n\r\n}\r\n\r\n// 顯示搜尋路線結果\r\nfunction showRouteResult(data){\r\n    const busSearchShow = document.querySelector('.bus_searchShow');\r\n    const busSearching = document.querySelector('.bus_searching');\r\n    const busSearchNone = document.querySelector('.bus_searchNone');\r\n    const busRouteResult = document.querySelector('.bus_routeResult');\r\n    \r\n    if(!data || data.length === 0) {\r\n        busSearching.classList.add('d-none');\r\n        busSearchNone.classList.remove('d-none');\r\n    } else {\r\n\r\n        let str = \"\";\r\n    \r\n        data.forEach(el=>{\r\n            str+=`\r\n            <div class=\"w-100 rounded-4 shadow-sm | py-3 px-4 mb-4\">\r\n                <div class=\"d-flex jc-sb | mb-2\">\r\n                    <h4 class=\"text-warning\">${el.RouteName.Zh_tw}</h4>\r\n                    <span class=\"material-icons-outlined text-dark\">\r\n                        favorite_border\r\n                    </span>\r\n                    <span class=\"material-icons text-danger d-none\">\r\n                        favorite\r\n                    </span>\r\n                </div>\r\n                <div class=\"d-flex jc-sb\">\r\n                    <p class=\"d-flex ai-c text-fontDark fz-4\">\r\n                        <span class=\"bus_searchResult_routeStart\">\r\n                            ${el.DepartureStopNameZh}\r\n                        </span>\r\n                        <span class=\"material-icons mx-2\">\r\n                            sync_alt\r\n                        </span>\r\n                        <span class=\"bus_searchResult_routeEnd\">\r\n                            ${el.DestinationStopNameZh}\r\n                        </span>\r\n                    </p>\r\n                    <p class=\"text-dark\">\r\n                        ${el.Operators[0].OperatorName.Zh_tw}\r\n                    </p>\r\n                </div>\r\n            </div>`\r\n        });\r\n    \r\n        busRouteResult.innerHTML = str;\r\n\r\n        busSearching.classList.add('d-none');\r\n        busSearchShow.classList.remove('d-none');\r\n    }\r\n\r\n}\r\n\r\n// 關鍵字比對 search_route\r\nfunction findMatch(keyword){\r\n    const regExp = new RegExp(keyword,'gi');\r\n    console.log(regExp);\r\n    return routeData.filter(el=>el.RouteName.Zh_tw.match(regExp) || el.DepartureStopNameZh.match(regExp) || el.DestinationStopNameZh.match(regExp));\r\n}\r\n\r\n// 渲染出比對結果\r\nfunction renderRoute(keyword){\r\n    const busSearchShow = document.querySelector('.bus_searchShow');\r\n    const busSearching = document.querySelector('.bus_searching');\r\n    const busSearchNone = document.querySelector('.bus_searchNone');\r\n    const busRouteResult = document.querySelector('.bus_routeResult');\r\n\r\n    const cacheData = findMatch(keyword);\r\n\r\n    let str = \"\";\r\n\r\n    if(!cacheData || cacheData.length === 0) {\r\n        console.log('NoData');\r\n        busSearching.classList.add('d-none');\r\n        busSearchShow.classList.add('d-none');\r\n        busSearchNone.classList.remove('d-none');\r\n    } else {\r\n        cacheData.forEach(el=>{\r\n            str+=`\r\n            <div class=\"w-100 rounded-4 shadow-sm | py-3 px-4 mb-4\">\r\n                <div class=\"d-flex jc-sb | mb-2\">\r\n                    <h4 class=\"text-warning\">${el.RouteName.Zh_tw}</h4>\r\n                    <span class=\"material-icons-outlined text-dark\">\r\n                        favorite_border\r\n                    </span>\r\n                    <span class=\"material-icons text-danger d-none\">\r\n                        favorite\r\n                    </span>\r\n                </div>\r\n                <div class=\"d-flex jc-sb\">\r\n                    <p class=\"d-flex ai-c text-fontDark fz-4\">\r\n                        <span class=\"bus_searchResult_routeStart\">\r\n                            ${el.DepartureStopNameZh}\r\n                        </span>\r\n                        <span class=\"material-icons mx-2\">\r\n                            sync_alt\r\n                        </span>\r\n                        <span class=\"bus_searchResult_routeEnd\">\r\n                            ${el.DestinationStopNameZh}\r\n                        </span>\r\n                    </p>\r\n                    <p class=\"text-dark\">\r\n                        ${el.Operators[0].OperatorName.Zh_tw}\r\n                    </p>\r\n                </div>\r\n            </div>`\r\n        });\r\n    \r\n        busRouteResult.innerHTML = str;\r\n\r\n        busSearching.classList.add('d-none');\r\n        busSearchNone.classList.add('d-none');\r\n        busSearchShow.classList.remove('d-none');\r\n    }\r\n}","// header 驗證\r\nfunction getAuthorizationHeader() {\r\n    let AppID = '9eeb30e3588740618367a446631cbc3f';\r\n    let AppKey = 'CKTwBadJd3_0_EdqiXE0kEg8fTw';\r\n    let GMTString = new Date().toGMTString();\r\n    let ShaObj = new jsSHA('SHA-1', 'TEXT');\r\n    ShaObj.setHMACKey(AppKey, 'TEXT');\r\n    ShaObj.update('x-date: ' + GMTString);\r\n    let HMAC = ShaObj.getHMAC('B64');\r\n    let Authorization = 'hmac username=\\\"' + AppID + '\\\", algorithm=\\\"hmac-sha1\\\", headers=\\\"x-date\\\", signature=\\\"' + HMAC + '\\\"';\r\n    return { 'Authorization': Authorization, 'X-Date': GMTString }; \r\n}\r\n"]}